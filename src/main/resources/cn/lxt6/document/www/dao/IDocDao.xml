<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.lxt6.document.www.dao.IDocDao">
    <select id="insertList" parameterType="map" resultType="int">
        set @count:=0;
        <foreach collection="docList" item="doc" index="index">
            insert into doc(
            <trim suffixOverrides=",">
                <foreach collection="doc.entrySet()" item="value" index="key">
                    <if test="key!='questParList' and key!='resultParList' and value!=null">
                        ${key},
                    </if>
                </foreach>
            </trim>
            )values(
            <trim suffixOverrides=",">
                <foreach collection="doc.entrySet()" item="value" index="key">
                    <if test="key!='questParList' and key!='resultParList' and value!=null">
                        '${value}',
                    </if>
                </foreach>
            </trim>
            );
            set @doc_id:=LAST_INSERT_ID();
            <if test="doc.questParList !=null">
                <foreach collection="doc.questParList" item="par" index="index">
                    insert into doc_par(doc_id,
                    <trim suffixOverrides=",">
                        <foreach collection="par.entrySet()" item="value" index="key">
                            <if test='value!=null'>
                                ${key},
                            </if>
                        </foreach>
                    </trim>
                    )values(@doc_id,
                    <trim suffixOverrides=",">
                        <foreach collection="par.entrySet()" item="value" index="key">
                            <if test='value!=null'>
                                '${value}',
                            </if>
                        </foreach>
                    </trim>
                    );
                </foreach>
            </if>
            <if test="doc.resultParList !=null">
                <foreach collection="doc.resultParList" item="par" index="index">
                    insert into doc_par(doc_id,
                    <trim suffixOverrides=",">
                        <foreach collection="par.entrySet()" item="value" index="key">
                            <if test='value!=null'>
                                ${key},
                            </if>
                        </foreach>
                    </trim>
                    )values(@doc_id,
                    <trim suffixOverrides=",">
                        <foreach collection="par.entrySet()" item="value" index="key">
                            <if test='value!=null'>
                                '${value}',
                            </if>
                        </foreach>
                    </trim>
                    );
                </foreach>
            </if>
            set @count=@count+1;
        </foreach>
        select @count;
    </select>
</mapper>
