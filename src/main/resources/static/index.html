<!DOCTYPE html>
<head>
    <title>文档管理-首页</title>
    <meta charset='utf-8'>
    <script src="js/vue.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/axios.min.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
<div id="fileSubmit">
    <h4>将html形式的接口文档存入数据库：</h4>
    <input type="file" ref="file" multiple="multiple"/><hr>
    <button type="button" @click="submit">提交</button>
    <p style="color: red">{{fileSubmitMsg}}</p>
</div>
<div id="docQuery">
    路由：<input type="text" ref="route"/> 名称：<input type="text" ref="name"/><hr>
    <button type="button" @click="query">查询接口</button>
    <p style="color: red">{{docQueryMsg}}</p>
</div>
<script>
    var fileSubmitV = new Vue({
        el: "#fileSubmit",
        data: {
            fileSubmitMsg:"",
        },
        methods: {
            submit: function () {
                var files = this.$refs.file.files;
                if (files.length==0){
                    this.fileSubmitMsg="请选择要写入的文件!"
                    return;
                }
                var fd = new FormData();
                var fileNum =0;//html文件数目
                for(var i=0;i<files.length;i++){
                    if (files[i].name.indexOf(".html")<0){
                        continue;
                    }
                    fileNum++;
                    fd.append("files", files[i]);
                }
                if (fileNum==0){
                    this.fileSubmitMsg="请选择html文件!"
                    return;
                }
                this.fileSubmitMsg="正在插入数据,请等待写入结果....";
                axios.post('/docs',fd).then(function(res){
                    this.fileSubmitMsg=res.data;
                });
            }
        }
    });
    var docQueryV = new Vue({
        el: "#docQuery",
        data: {
            docQueryMsg:"",
        }, methods: {
            query: function () {
                var route = this.$refs.route.value;
                var name = this.$refs.name.value;
                axios.get('/docs',{"name":name,"route":route}).then(function(res){
                    this.docQueryMsg=res.data;
                });
            }
        }
    });
</script>
</body>